<div class="pagedjs-html-viewer">
  <iframe src="{{ include.html_url }}" title="{{ include.title | default: 'Paged.js document viewer' }}" width="100%" height="100%" style="border: none;" loading="lazy" onload="redirectLinksOutsideIframe(this)">
    <p>It appears you cannot view this content directly within this page.</p>
    <p><a href="{{ include.html_url }}">Click here to open the document in a new tab.</a></p>
  </iframe>
</div>
<script>
  function redirectLinksOutsideIframe(iframe) {
  console.log('Script (Include): Iframe "' + iframe.title + '" loaded.');

  try {
    const iframeOrigin = new URL(iframe.src).origin;
    const pageOrigin = window.location.origin;

    if (iframeOrigin !== pageOrigin) {
      console.warn(`Script (Include): Skipping iframe rewrite (cross-origin): ${iframeOrigin}`);
      return;
    }

    const doc = iframe.contentDocument || iframe.contentWindow.document;
    console.log('Script (Include): Accessed iframe document for "' + iframe.title + '".');

    const links = doc.querySelectorAll('a[href]');
    links.forEach(link => {
      const href = link.getAttribute('href');
      if (!href || href.startsWith('#')) return;

      link.addEventListener('click', function (event) {
        event.preventDefault();
        window.open(href, '_blank', 'noopener');
      });

      console.log('Script (Include): Click listener attached to link:', href);
    });

  } catch (e) {
    console.warn('Script (Include): Could not access iframe content:', e);
  }
}
</script>
